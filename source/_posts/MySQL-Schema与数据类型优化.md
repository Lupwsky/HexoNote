---
title:       MySQL-Schema与数据类型优化
date:        2018-03-24                  15:23:41
categories:  高性能MySQL
---

良好的数据表设计是高性能的基石，应该根据系统需要执行的查询语句来设计 Schema，这往往需要需要考虑很多的因素，例如使用烦范式设计可以加快某些类型的查询，但同时也会使另一些查询变慢，例如添加计数表和汇总表可以优化查询速度，但是这会增加维护这些表的成本，当然这些都需要根据实际的情况来选择。
<!-- more -->

# 选择优化的数据类型

MySQL 支持很多的数据类型，合理的选择数据类型由助于提高性能，以下有几个建议的原则：

## 更小的数据类型

更小的数据类型占据更小的磁盘、内存和 CPU，但是要确保能够存储之后需要存储的值，否则后续修改会很痛苦，因为对大表修改表结构是很耗时间的操作。

## 使用简单的数据类型

简单的数据类型耗费更少的 CPU 资源，如整型的操作就比字符操作代价更低(字符集的校对规则比整型更加复杂)，例如使用 MySQL 内建的类型存储日期时间而不是使用字符串存储日期时间，使用整型存储 IP 地址而不是使用字符串存储。

## 尽量避免NULL

可为 NULL 的列使得索引、索引统计和值比较变得更加复杂。可为 NULL 的列使用索引时会使用更多的存储空间，在 MySQL 中需要特殊的处理，每个索引需要一个额外的字节，如果要在某一列上建立索引，尽量设计成 NOT NULL。把可以 NULL 的列变 NOT NULL 带来的性能提示较小，对于大表如果确定 NULL 值会带来问题才会选择去优化它。
例如在 where 子条件查询中对字段进行 NULL 判断 (如 where num is null )，会导致引擎放弃索引而进行全表扫描，但是如果将 NULL 判断更改为 where num = 0 引擎则会使用索引进行扫描。

# 数据类型

MySQL 支持多种的数据类型，了解这些数据类型有助于我们合理的设计 Scheme，提高查询的性能。

## 整数类型

MySQL 整数类型支持的整数类型如下：

  类型    | 存储空间
--------- | --------
TINYINT   | 8位
SMALLINT  | 16位
MEDIUMINT | 24位
INT       | 32位
BIGINT    | 64位

可以添加无符号关键字，大致可以使正数的范围提高一倍，如 TINYINT UNSIGNED 的存储范围为 0 ~ 255，TINYINT 则是 -128 ~ 127。
MySQL 可以为正数指定宽度，如 INT(11)，但是他不会显示值的范围，对于存储和计算来说INT(1) 和 INT(20) 都是一样的。

## 实数类型

 类型   |  存储空间
------- | -----------
FLOAT   | 4字节(32位)
DOUBLE  | 8字节(64位)
DECIMAL | - -

FLOAT 和 DOUBLE 支持使用标准的浮点运算进行近似运算，这会导致精度的损失，DECIMAL 用于存储精确的小数，因为 DECIMAL 需要额外的计算空间和计算开销，除非需要对小数进行精确计算时才使用 DECIMAL 类型，例如存储财务数据，但是在数据量大的情况下可以考虑 BIGINT 来替代。

## 字符串类型

MySQL 支持的字符串类型有 VARCHAR、CAHR、NVARCHAR、NCHAR。

### VARCHAR

VARCHAR 用于存储可变长度字符串，它只是用必要的空间，比定长类型更省空间。
VARCHAR 需要额外的 1 个或者 2 个字节记录字符串的长度，如果列的最大长度大于等于 255 字节没需要 1 个额外的字节表示，否则需要 2 个额外的字节。
在更新 VARCHAR 列时，如果长度超过了设置的最大可变长度，MyISAM 会将行拆成不同的片段存储，而 InnoDB 则需要分裂页来使行可以放进页内，这会导致碎片问题。

### CHAR
